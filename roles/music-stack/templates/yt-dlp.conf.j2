# yt-dlp configuration for music downloads optimized for maximum audio quality
# Extract audio only with best available quality
-x

# Format selection: get the absolute best audio quality available
--format "bestaudio/best"

# Sort formats to prioritize highest quality
--format-sort "abr,asr,+size"

# Audio settings for maximum quality (keep original format when it's already high quality)
--audio-format best
--audio-quality 0

# Comprehensive metadata embedding
--embed-metadata
--embed-thumbnail

# Enhanced metadata parsing for proper music library organization
--parse-metadata "title:%(title)s"
--parse-metadata "artist:%(uploader)s"
--parse-metadata "album:%(playlist_title|%(uploader)s - Singles)s"
--parse-metadata "album_artist:%(uploader)s"
--parse-metadata "track_number:%(playlist_index)d"
--parse-metadata "genre:Music"

# Music library optimized output template following yt-dlp best practices
--output "{{ music_library_path }}/downloads/%(uploader|Unknown Artist).100s/%(playlist_title|%(uploader)s - Singles).100s/%(title).200s.%(ext)s"

# Consistent placeholder for missing metadata
--output-na-placeholder "Unknown"

# Restrict filename characters to ASCII only
--restrict-filenames

# Download archive and error handling  
--download-archive "{{ music_library_path }}/youtube-archive.txt"
--cache-dir "{{ music_stack_home }}/config/cache"
--ignore-errors
--continue
--no-abort-on-error

# Network and performance optimization
--force-ipv4
--concurrent-fragments 10
--retries 3
--fragment-retries 3
--file-access-retries 3
--sleep-requests 1
--sleep-interval 0
--max-sleep-interval 5

# Rate limiting to be respectful
--limit-rate 2M
--throttled-rate 100K

# Limit downloads for testing (remove this line for full sync)
--max-downloads 5

# Sponsorship and unwanted content filtering
--sponsorblock-mark all
--sponsorblock-remove sponsor,selfpromo,interaction,intro,outro
