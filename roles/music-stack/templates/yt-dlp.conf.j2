# yt-dlp configuration for music downloads optimized for Beets integration
# Download best audio quality, preferably opus for better quality/size ratio
--format "bestaudio[acodec=opus]/bestaudio[ext=m4a]/bestaudio/best"

# Audio extraction and quality settings
--extract-audio
--audio-format opus
--audio-quality 0

# Essential metadata only (audio file + basic info)
--embed-thumbnail
--embed-metadata
--write-info-json

# Clean output template with better organization  
--output "{{ music_library_path }}/downloads/%(uploader)s/%(playlist_title|Unknown Album)s/%(playlist_index|00)s - %(title)s.%(ext)s"

# Download archive and error handling
--download-archive "{{ music_stack_home }}/config/youtube-archive.txt"
--cache-dir "{{ music_stack_home }}/config/cache"
--ignore-errors
--continue
--no-abort-on-error
--ignore-unavailable

# Network and performance optimization
--force-ipv4
--concurrent-fragments 10
--retries 3
--fragment-retries 3
--file-access-retries 3
--sleep-requests 1
--sleep-interval 0
--max-sleep-interval 5

# Rate limiting to be respectful
--limit-rate 2M
--throttled-rate 100K

# Basic metadata processing (keep it simple)
--add-metadata

# Sponsorship and unwanted content filtering
--sponsorblock-mark all
--sponsorblock-remove sponsor,selfpromo,interaction,intro,outro